<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vigen√®re Cipher Brute Force Decryption</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/11.7.12/sweetalert2.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/11.7.12/sweetalert2.min.js"></script>
  <style>
    :root {
      --primary-color: #3f51b5;
      --primary-dark: #303f9f;
      --accent-color: #ff4081;
      --light-bg: #f5f7ff;
      --dark-text: #333;
      --light-text: #fff;
      --shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      --border-radius: 8px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #e0e8ff 0%, #d8e2ff 100%);
      color: var(--dark-text);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      background-color: white;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      width: 100%;
      max-width: 750px;
      overflow: hidden;
    }

    header {
      background-color: var(--primary-color);
      color: var(--light-text);
      padding: 20px;
      text-align: center;
      position: relative;
    }

    header h1 {
      font-size: 24px;
      margin-bottom: 8px;
    }

    header p {
      font-size: 14px;
      opacity: 0.9;
    }

    .icon {
      position: absolute;
      top: 20px;
      left: 20px;
      font-size: 24px;
    }

    .content {
      padding: 24px;
    }

    .input-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--primary-dark);
    }

    textarea {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0ff;
      border-radius: var(--border-radius);
      font-size: 16px;
      resize: vertical;
      min-height: 120px;
      transition: border-color 0.3s ease;
      font-family: 'Consolas', monospace;
    }

    textarea:focus {
      border-color: var(--primary-color);
      outline: none;
    }

    .controls {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }

    .key-length {
      flex: 1;
      min-width: 150px;
    }

    input[type="number"] {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0ff;
      border-radius: var(--border-radius);
      font-size: 16px;
      transition: border-color 0.3s ease;
    }

    input[type="number"]:focus {
      border-color: var(--primary-color);
      outline: none;
    }

    .actions {
      display: flex;
      gap: 12px;
      margin-top: 20px;
    }

    button {
      padding: 12px 24px;
      font-size: 16px;
      font-weight: 600;
      border: none;
      border-radius: var(--border-radius);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    #decryptBtn {
      background-color: var(--primary-color);
      color: var(--light-text);
      flex: 2;
    }

    #decryptBtn:hover {
      background-color: var(--primary-dark);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    #clearBtn {
      background-color: #f5f5f5;
      color: #666;
      flex: 1;
    }

    #clearBtn:hover {
      background-color: #e0e0e0;
    }

    .loading {
      display: none;
      text-align: center;
      margin: 20px 0;
    }

    .loading-spinner {
      border: 4px solid rgba(0, 0, 0, 0.1);
      border-radius: 50%;
      border-top: 4px solid var(--primary-color);
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }
      100% {
        transform: rotate(360deg);
      }
    }

    #results-container {
      margin-top: 24px;
      display: none;
    }

    .results-header {
      margin-bottom: 12px;
    }

    .results-header h2 {
      font-size: 18px;
      color: var(--primary-dark);
      margin-bottom: 15px;
    }

    .results-actions {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 20px;
    }

    .results-actions button {
      padding: 10px;
      font-size: 14px;
      font-weight: bold;
      color: #fff;
      background-color: var(--primary-color);
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      width: 100%;
    }

    .results-actions button:hover {
      background-color: var(--primary-dark);
    }

    .filter-input {
      padding: 10px;
      border: 1px solid #e0e0ff;
      border-radius: var(--border-radius);
      font-size: 14px;
      width: 100%;
      margin-top: 10px;
    }

    #results {
      margin-top: 12px;
      padding: 16px;
      background-color: var(--light-bg);
      border-radius: var(--border-radius);
      max-height: 300px;
      overflow-y: auto;
      font-family: 'Consolas', monospace;
      font-size: 14px;
    }

    .result-item {
      padding: 10px;
      margin-bottom: 8px;
      background-color: white;
      border-radius: 4px;
      border-left: 4px solid var(--primary-color);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    .key {
      font-weight: bold;
      color: var(--primary-color);
    }

    .plaintext {
      margin-top: 6px;
      word-break: break-all;
    }

    .copy-btn {
      background-color: transparent;
      color: var(--primary-color);
      padding: 4px 8px;
      font-size: 12px;
      margin-top: 6px;
      border: 1px solid var(--primary-color);
      border-radius: 4px;
      width: auto;
    }

    .copy-btn:hover {
      background-color: var(--primary-color);
      color: white;
    }

    .footer {
      text-align: center;
      margin-top: 20px;
      padding-top: 16px;
      border-top: 1px solid #eee;
      font-size: 14px;
      color: #666;
    }

    .info {
      background-color: #e8f4fd;
      border-left: 4px solid #2196F3;
      padding: 12px;
      margin-bottom: 20px;
      border-radius: 4px;
      font-size: 14px;
    }

    /* Media queries for responsive design */
    @media (max-width: 600px) {
      .controls {
        flex-direction: column;
      }

      header h1 {
        font-size: 20px;
      }

      .actions {
        flex-direction: column;
      }

      #decryptBtn,
      #clearBtn {
        width: 100%;
      }
      
      /* Hide sorting and filtering on mobile */
      .results-controls-mobile {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      
      /* Toggle button for mobile */
      #toggleControlsBtn {
        display: block;
        width: 100%;
        background-color: var(--primary-dark);
        color: white;
        padding: 10px;
        text-align: center;
        border-radius: var(--border-radius);
        margin-bottom: 10px;
        cursor: pointer;
      }
      
      /* Mobile control panel (hidden by default) */
      .mobile-controls {
        display: none;
        padding: 10px;
        background-color: var(--light-bg);
        border-radius: var(--border-radius);
        margin-bottom: 15px;
      }
      
      .mobile-controls.show {
        display: block;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="icon">üîê</div>
      <h1>Vigen√®re Cipher Brute Force Decryption</h1>
      <p>Decrypt Vigen√®re ciphers by testing all possible keys of a given length</p>
    </header>

    <div class="content">
      <div class="info">
        <strong>Tentang Vigen√®re Cipher:</strong> Vigen√®re adalah sandi substitusi polialfabetik klasik yang menggunakan deretan sandi Caesar berbeda untuk mengenkripsi pesan. Alat ini mencoba semua kemungkinan kunci untuk memecahkan sandi.
      </div>

      <div class="input-group">
        <label for="ciphertext">Teks Tersandi (Ciphertext):</label>
        <textarea id="ciphertext" placeholder="Masukkan teks tersandi di sini..." rows="5"></textarea>
      </div>

      <div class="controls">
        <div class="key-length">
          <label for="keyLength">Panjang Kunci:</label>
          <input type="number" id="keyLength" min="1" max="5" value="3">
        </div>
        <div class="key-length">
          <label for="maxResults">Jumlah Hasil Maksimum:</label>
          <input type="number" id="maxResults" min="1" max="1000" value="50">
        </div>
      </div>

      <div class="actions">
        <button id="decryptBtn" label="Decrypt" type="button">Dekripsi</button>
        <button id="clearBtn" label="Clear" type="button">Bersihkan</button>
      </div>

      <div class="loading">
        <div class="loading-spinner"></div>
        <p>Memproses... Harap tunggu.</p>
      </div>

      <div id="results-container">
        <div class="results-header">
          <h2>Hasil Dekripsi</h2>
          
          <!-- New toggle button for mobile -->
          <div class="results-controls-mobile">
            <button id="toggleControlsBtn">Tampilkan/Sembunyikan Opsi</button>
            
            <!-- Mobile control panel -->
            <div class="mobile-controls">
              <div class="results-actions">
                <button id="sortKeyBtn">Urutkan Berdasarkan Kunci</button>
                <button id="sortTextBtn">Urutkan Berdasarkan Teks</button>
                <button id="sortScoreBtn">Urutkan Berdasarkan Skor</button>
                <input type="text" class="filter-input" id="resultFilter" placeholder="Filter hasil...">
              </div>
            </div>
          </div>
        </div>
        <div id="results"></div>
      </div>
    </div>

    <div class="footer">
      <p>Dikembangkan untuk keamanan dan pembelajaran kriptografi</p>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const ciphertextInput = document.getElementById("ciphertext");
      const keyLengthInput = document.getElementById("keyLength");
      const maxResultsInput = document.getElementById("maxResults");
      const decryptBtn = document.getElementById("decryptBtn");
      const clearBtn = document.getElementById("clearBtn");
      const resultsContainer = document.getElementById("results-container");
      const results = document.getElementById("results");
      const loading = document.querySelector(".loading");
      const resultFilter = document.getElementById("resultFilter");
      const sortKeyBtn = document.getElementById("sortKeyBtn");
      const sortTextBtn = document.getElementById("sortTextBtn");
      const sortScoreBtn = document.getElementById("sortScoreBtn");
      const toggleControlsBtn = document.getElementById("toggleControlsBtn");
      const mobileControls = document.querySelector(".mobile-controls");

      // Toggle mobile controls visibility
      toggleControlsBtn.addEventListener("click", function() {
        mobileControls.classList.toggle("show");
        this.textContent = mobileControls.classList.contains("show") ? 
          "Sembunyikan Opsi" : "Tampilkan Opsi";
      });

      function sortByKey() {
        const resultItems = Array.from(document.querySelectorAll(".result-item"));
        resultItems.sort((a, b) => {
          const keyA = a.querySelector(".key").textContent.toLowerCase();
          const keyB = b.querySelector(".key").textContent.toLowerCase();
          return keyA.localeCompare(keyB);
        });
        resultItems.forEach((item) => results.appendChild(item));
      }

      function sortByScore() {
        const resultItems = Array.from(document.querySelectorAll(".result-item"));
        resultItems.sort((a, b) => {
          const scoreA = parseFloat(
            a.querySelector(".key").textContent.match(/Skor: (\d+\.\d+)/)[1]
          );
          const scoreB = parseFloat(
            b.querySelector(".key").textContent.match(/Skor: (\d+\.\d+)/)[1]
          );
          return scoreB - scoreA;
        });
        resultItems.forEach((item) => results.appendChild(item));
      }

      function sortByText() {
        const resultItems = Array.from(document.querySelectorAll(".result-item"));
        resultItems.sort((a, b) => {
          const textA = a.querySelector(".plaintext").textContent.toLowerCase();
          const textB = b.querySelector(".plaintext").textContent.toLowerCase();
          return textA.localeCompare(textB);
        });
        resultItems.forEach((item) => results.appendChild(item));
      }

      sortKeyBtn.addEventListener("click", sortByKey);
      sortTextBtn.addEventListener("click", sortByText);
      sortScoreBtn.addEventListener("click", sortByScore);

      // Fungsi untuk mendekripsi teks dengan kunci tertentu
      function vigenereDecrypt(ciphertext, key) {
        let plaintext = "";
        key = key.toLowerCase();
        const keyIndices = [...key].map((k) => k.charCodeAt(0) - "a".charCodeAt(0));
        const keyLength = key.length;

        let i = 0;
        for (const char of ciphertext) {
          if (/[a-zA-Z]/.test(char)) {
            const isUpperCase = char === char.toUpperCase();
            const offset = isUpperCase ? "A".charCodeAt(0) : "a".charCodeAt(0);
            const charIndex = char.toLowerCase().charCodeAt(0) - "a".charCodeAt(0);
            const keyIndex = keyIndices[i % keyLength];
            const plainIndex = (charIndex - keyIndex + 26) % 26;
            plaintext += String.fromCharCode(plainIndex + offset);
            i++;
          } else {
            plaintext += char;
          }
        }

        return plaintext;
      }

      // Menggunakan iterators untuk menghasilkan kunci dengan lebih efisien
      function* keyGenerator(length) {
        const characters = "abcdefghijklmnopqrstuvwxyz";
        const charCount = characters.length;

        // Membuat array indeks untuk melacak posisi dalam menghasilkan kunci
        const indices = new Array(length).fill(0);

        while (true) {
          // Menghasilkan kunci saat ini
          let key = "";
          for (let i = 0; i < length; i++) {
            key += characters[indices[i]];
          }
          yield key;

          // Memperbarui indeks untuk kombinasi berikutnya
          let pos = length - 1;
          while (pos >= 0) {
            indices[pos]++;
            if (indices[pos] < charCount) {
              break;
            }
            indices[pos] = 0;
            pos--;
          }

          // Jika kita telah mencapai akhir dari semua kombinasi
          if (pos < 0) {
            break;
          }
        }
      }

      // Fungsi untuk mengukur kualitas teks (kemungkinan bahasa Inggris)
      // Menggunakan frekuensi umum karakter dan bigram
      function scoreText(text) {
        const frequencyMap = {
          e: 12.7, t: 9.1, a: 8.2, o: 7.5, i: 7, n: 6.7, s: 6.3, h: 6, r: 6, d: 4.3,
          l: 4, u: 2.8, c: 2.8, m: 2.4, w: 2.4, f: 2.2, g: 2, y: 2, p: 1.9, b: 1.5,
          v: 1, k: 0.8, j: 0.2, x: 0.2, q: 0.1, z: 0.1,
        };

        // Common English bigrams
        const bigramMap = {
          th: 3.56, he: 3.07, in: 2.43, er: 2.05, an: 1.99, re: 1.85, on: 1.76, 
          at: 1.49, en: 1.45, nd: 1.35,
        };

        // Common English word beginnings
        const commonBeginnings = ["th", "wh", "tr", "st", "pr", "pl", "gr", "ch"];

        // Common English word endings
        const commonEndings = ["ing", "ed", "ly", "er", "tion", "es", "s", "ment"];

        let score = 0;
        const cleanText = text.toLowerCase().replace(/[^a-z]/g, "");

        // Character frequency score
        for (let i = 0; i < cleanText.length; i++) {
          const char = cleanText[i];
          if (frequencyMap[char]) {
            score += frequencyMap[char];
          }
        }

        // Bigram score
        for (let i = 0; i < cleanText.length - 1; i++) {
          const bigram = cleanText.substr(i, 2);
          if (bigramMap[bigram]) {
            score += bigramMap[bigram] * 2; // Give more weight to bigrams
          }
        }

        // Word pattern score - split by spaces and check patterns
        const words = text.toLowerCase().split(/\s+/);
        for (const word of words) {
          if (word.length > 2) {
            // Check for common beginnings
            for (const beginning of commonBeginnings) {
              if (word.startsWith(beginning)) {
                score += 5;
              }
            }

            // Check for common endings
            for (const ending of commonEndings) {
              if (word.endsWith(ending)) {
                score += 5;
              }
            }
          }
        }

        // Normalize score by text length
        return score / cleanText.length;
      }

      // Fungsi untuk menghasilkan MD5 hash (untuk identifikasi unik)
      function simpleHash(str) {
        let hash = 0;
        if (str.length === 0) return hash;
        for (let i = 0; i < str.length; i++) {
          const char = str.charCodeAt(i);
          hash = (hash << 5) - hash + char;
          hash = hash & hash; // Convert to 32bit integer
        }
        return hash;
      }

      // Fungsi untuk mendekripsi teks
      function decryptText() {
        const ciphertext = ciphertextInput.value.trim();
        const keyLength = parseInt(keyLengthInput.value, 10);
        const maxResults = parseInt(maxResultsInput.value, 10);

        if (!ciphertext) {
          Swal.fire({
            icon: "error",
            title: "Oops...",
            text: "Silakan masukkan teks tersandi.",
          });
          return;
        }

        if (!keyLength || keyLength <= 0 || keyLength > 5) {
          Swal.fire({
            icon: "error",
            title: "Oops...",
            text: "Silakan masukkan panjang kunci antara 1-5.",
          });
          return;
        }

        loading.style.display = "block";
        results.innerHTML = "";
        resultsContainer.style.display = "none";

        // Menggunakan setTimeout untuk memberi waktu UI memperbarui sebelum memulai proses yang intensif
        setTimeout(() => {
          const decryptedResults = [];
          const keysGenerator = keyGenerator(keyLength);
          const uniqueResults = new Set();

          let count = 0;
          let key;

          while (!(key = keysGenerator.next()).done) {
            const currentKey = key.value;
            const decrypted = vigenereDecrypt(ciphertext, currentKey);
            const resultHash = simpleHash(decrypted);

            // Hanya menyimpan hasil yang unik
            if (!uniqueResults.has(resultHash)) {
              uniqueResults.add(resultHash);

              // Menghitung skor untuk peringkat
              const score = scoreText(decrypted);

              decryptedResults.push({
                key: currentKey,
                plaintext: decrypted,
                score: score,
              });

              count++;
              if (count >= 10000) {
                // Batas keamanan
                break;
              }
            }
          }

          // Urutkan hasil berdasarkan skor (kemungkinan bahasa Inggris)
          decryptedResults.sort((a, b) => b.score - a.score);

          // Tampilkan hasil terbatas
          const limitedResults = decryptedResults.slice(0, maxResults);

          if (limitedResults.length === 0) {
            results.innerHTML = "<p>Tidak ada hasil yang ditemukan.</p>";
          } else {
            // limitedResults.forEach((result, index) => {
            decryptedResults.forEach((result, index) => {
              const resultElement = document.createElement("div");
              resultElement.className = "result-item";
              resultElement.innerHTML = `
                <div class="key">Kunci: ${
                  result.key
                } (Skor: ${result.score.toFixed(2)})</div>
                <div class="plaintext">${result.plaintext}</div>
                <button class="copy-btn" data-text="${
                  result.plaintext
                }">Salin Teks</button>
              `;
              results.appendChild(resultElement);
            });

            // Tambahkan event listener untuk tombol salin
            document.querySelectorAll(".copy-btn").forEach((button) => {
              button.addEventListener("click", function () {
                const textToCopy = this.getAttribute("data-text");
                navigator.clipboard.writeText(textToCopy).then(() => {
                  const originalText = this.textContent;
                  this.textContent = "Tersalin!";
                  Swal.fire({
                    icon: "success",
                    title: "Teks Tersalin!",
                    text: "Teks berhasil disalin ke clipboard.",
                  });
                  setTimeout(() => {
                    this.textContent = originalText;
                  }, 2000);
                });
              });
            });
          }

          loading.style.display = "none";
          resultsContainer.style.display = "block";
        }, 100);
      }

      // Fungsi untuk membersihkan input dan hasil
      function clearAll() {
        ciphertextInput.value = "";
        results.innerHTML = "";
        resultsContainer.style.display = "none";
        ciphertextInput.focus();
      }

      // Fungsi untuk memfilter hasil
      function filterResults() {
        const filterText = resultFilter.value.toLowerCase();
        document.querySelectorAll(".result-item").forEach((item) => {
          const keyText = item.querySelector(".key").textContent.toLowerCase();
          const plaintext = item
            .querySelector(".plaintext")
            .textContent.toLowerCase();

          if (keyText.includes(filterText) || plaintext.includes(filterText)) {
            item.style.display = "block";
          } else {
            item.style.display = "none";
          }
        });
      }

      // Event listeners
      decryptBtn.addEventListener("click", decryptText);
      clearBtn.addEventListener("click", clearAll);
      resultFilter.addEventListener("input", filterResults);

      // Tambahkan validasi untuk input
      keyLengthInput.addEventListener("input", function () {
        if (this.value > 5) {
          this.value = 5;
          Swal.fire({
            icon: "error",
            title: "Oops...",
            text: "Maksimum panjang kunci adalah 5 untuk mencegah waktu pemrosesan yang terlalu lama.",
          });
        }
      });

      // Tambahkan kemampuan menekan Enter untuk mendekripsi
      ciphertextInput.addEventListener("keydown", function (e) {
        if (e.key === "Enter" && e.ctrlKey) {
          decryptText();
        }
      });
    });
  </script>
</div>